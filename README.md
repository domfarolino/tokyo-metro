# tokyo-metro ðŸš‡

## Tokyo Metro SVG map

<img src="tokyo-metro.svg">

## Lines

<table>
  <tr>
    <th colspan=5><img src="static/icon_ginza.png"><h3>Ginza</h3></th>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_g01.png"></td>
    <td><img width=50px src="static/icon_g02.png"></td>
    <td><img width=50px src="static/icon_g03.png"></td>
    <td><img width=50px src="static/icon_g04.png"></td>
    <td><img width=50px src="static/icon_g05.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_g06.png"></td>
    <td><img width=50px src="static/icon_g07.png"></td>
    <td><img width=50px src="static/icon_g08.png"></td>
    <td><img width=50px src="static/icon_g09.png"></td>
    <td><img width=50px src="static/icon_g10.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_g11.png"></td>
    <td><img width=50px src="static/icon_g12.png"></td>
    <td><img width=50px src="static/icon_g13.png"></td>
    <td><img width=50px src="static/icon_g14.png"></td>
    <td><img width=50px src="static/icon_g15.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_g16.png"></td>
    <td><img width=50px src="static/icon_g17.png"></td>
    <td><img width=50px src="static/icon_g18.png"></td>
    <td><img width=50px src="static/icon_g19.png"></td>
  </tr>
</table>

<table>
  <tr>
    <th colspan=5><img src="static/icon_marunouchi.png"><h3>Marunouchi</h3></th>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_m01.png"></td>
    <td><img width=50px src="static/icon_m02.png"></td>
    <td><img width=50px src="static/icon_m03.png"></td>
    <td><img width=50px src="static/icon_m04.png"></td>
    <td><img width=50px src="static/icon_m05.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_m06.png"></td>
    <td><img width=50px src="static/icon_m07.png"></td>
    <td><img width=50px src="static/icon_m08.png"></td>
    <td><img width=50px src="static/icon_m09.png"></td>
    <td><img width=50px src="static/icon_m10.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_m11.png"></td>
    <td><img width=50px src="static/icon_m12.png"></td>
    <td><img width=50px src="static/icon_m13.png"></td>
    <td><img width=50px src="static/icon_m14.png"></td>
    <td><img width=50px src="static/icon_m15.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_m16.png"></td>
    <td><img width=50px src="static/icon_m17.png"></td>
    <td><img width=50px src="static/icon_m18.png"></td>
    <td><img width=50px src="static/icon_m19.png"></td>
    <td><img width=50px src="static/icon_m20.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_m21.png"></td>
    <td><img width=50px src="static/icon_m22.png"></td>
    <td><img width=50px src="static/icon_m23.png"></td>
    <td><img width=50px src="static/icon_m24.png"></td>
  </tr>
</table>

<table>
  <tr>
    <th colspan=5><img src="static/icon_hibiya.png"><h3>Hibiya</h3></th>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_h01.png"></td>
    <td><img width=50px src="static/icon_h02.png"></td>
    <td><img width=50px src="static/icon_h03.png"></td>
    <td><img width=50px src="static/icon_h04.png"></td>
    <td><img width=50px src="static/icon_h05.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_h06.png"></td>
    <td><img width=50px src="static/icon_h07.png"></td>
    <td><img width=50px src="static/icon_h08.png"></td>
    <td><img width=50px src="static/icon_h09.png"></td>
    <td><img width=50px src="static/icon_h10.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_h11.png"></td>
    <td><img width=50px src="static/icon_h12.png"></td>
    <td><img width=50px src="static/icon_h13.png"></td>
    <td><img width=50px src="static/icon_h14.png"></td>
    <td><img width=50px src="static/icon_h15.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_h16.png"></td>
    <td><img width=50px src="static/icon_h17.png"></td>
    <td><img width=50px src="static/icon_h18.png"></td>
    <td><img width=50px src="static/icon_h19.png"></td>
    <td><img width=50px src="static/icon_h20.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_h21.png"></td>
    <td><img width=50px src="static/icon_h22.png"></td>
  </tr>
</table>

<table>
  <tr>
    <th colspan=5><img src="static/icon_tozai.png"><h3>Tozai</h3></th>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_t01.png"></td>
    <td><img width=50px src="static/icon_t02.png"></td>
    <td><img width=50px src="static/icon_t03.png"></td>
    <td><img width=50px src="static/icon_t04.png"></td>
    <td><img width=50px src="static/icon_t05.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_t06.png"></td>
    <td><img width=50px src="static/icon_t07.png"></td>
    <td><img width=50px src="static/icon_t08.png"></td>
    <td><img width=50px src="static/icon_t09.png"></td>
    <td><img width=50px src="static/icon_t10.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_t11.png"></td>
    <td><img width=50px src="static/icon_t12.png"></td>
    <td><img width=50px src="static/icon_t13.png"></td>
    <td><img width=50px src="static/icon_t14.png"></td>
    <td><img width=50px src="static/icon_t15.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_t16.png"></td>
    <td><img width=50px src="static/icon_t17.png"></td>
    <td><img width=50px src="static/icon_t18.png"></td>
    <td><img width=50px src="static/icon_t19.png"></td>
    <td><img width=50px src="static/icon_t20.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_t21.png"></td>
    <td><img width=50px src="static/icon_t22.png"></td>
  </tr>
</table>

<table>
  <tr>
    <th colspan=5><img src="static/icon_chiyoda.png"><h3>Chiyoda</h3></th>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_c01.png"></td>
    <td><img width=50px src="static/icon_c02.png"></td>
    <td><img width=50px src="static/icon_c03.png"></td>
    <td><img width=50px src="static/icon_c04.png"></td>
    <td><img width=50px src="static/icon_c05.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_c06.png"></td>
    <td><img width=50px src="static/icon_c07.png"></td>
    <td><img width=50px src="static/icon_c08.png"></td>
    <td><img width=50px src="static/icon_c09.png"></td>
    <td><img width=50px src="static/icon_c10.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_c11.png"></td>
    <td><img width=50px src="static/icon_c12.png"></td>
    <td><img width=50px src="static/icon_c13.png"></td>
    <td><img width=50px src="static/icon_c14.png"></td>
    <td><img width=50px src="static/icon_c15.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_c16.png"></td>
    <td><img width=50px src="static/icon_c17.png"></td>
    <td><img width=50px src="static/icon_c18.png"></td>
    <td><img width=50px src="static/icon_c19.png"></td>
    <td><img width=50px src="static/icon_c20.png"></td>
  </tr>
</table>

<table>
  <tr>
    <th colspan=5><img src="static/icon_yurakucho.png"><h3>Yurakucho</h3></th>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_y01.png"></td>
    <td><img width=50px src="static/icon_y02.png"></td>
    <td><img width=50px src="static/icon_y03.png"></td>
    <td><img width=50px src="static/icon_y04.png"></td>
    <td><img width=50px src="static/icon_y05.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_y06.png"></td>
    <td><img width=50px src="static/icon_y07.png"></td>
    <td><img width=50px src="static/icon_y08.png"></td>
    <td><img width=50px src="static/icon_y09.png"></td>
    <td><img width=50px src="static/icon_y10.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_y11.png"></td>
    <td><img width=50px src="static/icon_y12.png"></td>
    <td><img width=50px src="static/icon_y13.png"></td>
    <td><img width=50px src="static/icon_y14.png"></td>
    <td><img width=50px src="static/icon_y15.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_y16.png"></td>
    <td><img width=50px src="static/icon_y17.png"></td>
    <td><img width=50px src="static/icon_y18.png"></td>
    <td><img width=50px src="static/icon_y19.png"></td>
    <td><img width=50px src="static/icon_y20.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_y21.png"></td>
    <td><img width=50px src="static/icon_y22.png"></td>
    <td><img width=50px src="static/icon_y23.png"></td>
    <td><img width=50px src="static/icon_y24.png"></td>
  </tr>
</table>

<table>
  <tr>
    <th colspan=5><img src="static/icon_hanzomon.png"><h3>Hanzomon</h3></th>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_h01.png"></td>
    <td><img width=50px src="static/icon_h02.png"></td>
    <td><img width=50px src="static/icon_h03.png"></td>
    <td><img width=50px src="static/icon_h04.png"></td>
    <td><img width=50px src="static/icon_h05.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_h06.png"></td>
    <td><img width=50px src="static/icon_h07.png"></td>
    <td><img width=50px src="static/icon_h08.png"></td>
    <td><img width=50px src="static/icon_h09.png"></td>
    <td><img width=50px src="static/icon_h10.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_h11.png"></td>
    <td><img width=50px src="static/icon_h12.png"></td>
    <td><img width=50px src="static/icon_h13.png"></td>
    <td><img width=50px src="static/icon_h14.png"></td>
    <td><img width=50px src="static/icon_h15.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_h16.png"></td>
    <td><img width=50px src="static/icon_h17.png"></td>
    <td><img width=50px src="static/icon_h18.png"></td>
    <td><img width=50px src="static/icon_h19.png"></td>
    <td><img width=50px src="static/icon_h20.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_h21.png"></td>
    <td><img width=50px src="static/icon_h22.png"></td>
  </tr>
</table>

<table>
  <tr>
    <th colspan=5><img src="static/icon_namboku.png"><h3>Namboku</h3></th>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_n01.png"></td>
    <td><img width=50px src="static/icon_n02.png"></td>
    <td><img width=50px src="static/icon_n03.png"></td>
    <td><img width=50px src="static/icon_n04.png"></td>
    <td><img width=50px src="static/icon_n05.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_n06.png"></td>
    <td><img width=50px src="static/icon_n07.png"></td>
    <td><img width=50px src="static/icon_n08.png"></td>
    <td><img width=50px src="static/icon_n09.png"></td>
    <td><img width=50px src="static/icon_n10.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_n11.png"></td>
    <td><img width=50px src="static/icon_n12.png"></td>
    <td><img width=50px src="static/icon_n13.png"></td>
    <td><img width=50px src="static/icon_n14.png"></td>
    <td><img width=50px src="static/icon_n15.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_n16.png"></td>
    <td><img width=50px src="static/icon_n17.png"></td>
    <td><img width=50px src="static/icon_n18.png"></td>
    <td><img width=50px src="static/icon_n19.png"></td>
  </tr>
</table>

<table>
  <tr>
    <th colspan=5><img src="static/icon_fukutoshin.png"><h3>Fukutoshin</h3></th>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_f01.png"></td>
    <td><img width=50px src="static/icon_f02.png"></td>
    <td><img width=50px src="static/icon_f03.png"></td>
    <td><img width=50px src="static/icon_f04.png"></td>
    <td><img width=50px src="static/icon_f05.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_f06.png"></td>
    <td><img width=50px src="static/icon_f07.png"></td>
    <td><img width=50px src="static/icon_f08.png"></td>
    <td><img width=50px src="static/icon_f09.png"></td>
    <td><img width=50px src="static/icon_f10.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_f11.png"></td>
    <td><img width=50px src="static/icon_f12.png"></td>
    <td><img width=50px src="static/icon_f13.png"></td>
    <td><img width=50px src="static/icon_f14.png"></td>
    <td><img width=50px src="static/icon_f15.png"></td>
  </tr>
  <tr>
    <td><img width=50px src="static/icon_f16.png"></td>
  </tr>
</table>

## Colors

Each Tokyo Metro line has an official color, and they're pretty easy to find.

## OSM relations

This is the [Overpass turbo](https://wiki.openstreetmap.org/wiki/Overpass_turbo)
query I used to fetch the [GeoJSON](https://geojson.org/) relation file for each
Tokyo Metro line.

```
/*
This is an example Overpass query.
Try it out by pressing the Run button above!
You can find more examples with the Load tool.
*/

[out:json][timeout:60];

// Ginza line route relation.
//
// See https://wiki.openstreetmap.org/wiki/Tokyo_Metro for each line's relation.
relation(443281);

// Get all member ways + their nodes
(way(r); >;);

// Dump everything
out body;
```

I used https://wiki.openstreetmap.org/wiki/Tokyo_Metro to get the OSM for each
line, except the Tozai line. That site specified the relation
[`443260`](https://www.openstreetmap.org/relation/443260), but when you click
it, nothing shows up, and the history says it was deleted over 11 years ago.

<img src="static/tozai-deleted.png" width=300>

I then found
https://commons.wikimedia.org/wiki/Category:Tokyo_Metro_T%C5%8Dzai_Line, which
lists the Tozai line relation as
[`8026124`](https://www.openstreetmap.org/relation/8026124).

<img src="static/new-tozai-relation-id.png" width=300>

Unfortunately, fetching this relation yielded no data â€” an absolutely empty
`export.geojson`. I quickly realized that This is because the relation is just a
container relation, holding the various *sub*-relations for each of the Tozai
line variations: local/rapid/commuter rapid.

<img src="static/tozai-sub-relations.png" width=300>

I chose the local variant since it listed all the stops; this is relation
[`5371620`](https://www.openstreetmap.org/relation/5371620).

## Line merging

The OSM GeoJSON data gives a ton of disconnected subway line segments (as
`LineString`s), but almost all of them have starting coordinates that match
another segment's *end* coordinates, or vice versa. This gives us an opportunity
to merge as many segments as possible, not only to create a simpler graph
structure, but to reduce visual artifacts in the SVG produced by many separate
`<polyline>`s. See the before and after below:

<table>
  <tr>
    <th>Before line merging</th>
    <th>After line merging</th>
  </tr>
  <tr>
    <td><img src="static/before-line-merging.png" width=300></td>
    <td><img src="static/after-line-merging.png" width=300></td>
  </tr>
</table>

The line merging algorithm right now is pretty simple and dumb; it makes some
assumptions that hold for Tokyo Metro's data set, to avoid complexity.
